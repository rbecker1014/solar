<!doctype html>
<html>
  <body>
    <h3>Solar Production Entry </h3>
    <p>Most recent date in table: <strong id="lastDate">Loading…</strong></p>

    <form id="f">
      <label>Date <input name="date" type="date" required></label>
      <label>ITD <input name="itd" type="number" step="any" required></label>
      <label>Prod <input name="prod" type="number" step="any" required></label>
      <button>Submit</button>
    </form>

    <pre id="out"></pre>

   <script>
  const ENDPOINT = "https://script.google.com/macros/s/AKfycbx0pKnubeqxxJXvUbmd9vvfxdHCZqleMppnZEajNSCyr5SAqEpP4Id249iA2OBFDpZc/exec";
  const TOKEN = "Rick_c9b8f4f2a0d34d0c9e2b6a7c5f1e4a3d";

  document.getElementById('f').addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const data = new URLSearchParams();
    data.set('token', TOKEN);
    data.set('date', fd.get('date'));
    data.set('itd',  fd.get('itd'));
    data.set('prod', fd.get('prod'));

    // application/x-www-form-urlencoded → no CORS preflight
    const res = await fetch(ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
      body: data.toString()
    });

    const text = await res.text(); // for troubleshooting
    try {
      const json = JSON.parse(text);
      document.getElementById('out').textContent = JSON.stringify(json, null, 2);
    } catch {
      document.getElementById('out').textContent = text;
    }
  });
</script>

  </body>
</html>
